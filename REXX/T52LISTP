/** REXX THE WONDER DOGG                                 **/
/**********************************************************/
/**********************************************************/
/** EXEC NAME        : T51LISTP                          **/
/** LAST MODIFIED    : 11 JUL 94                         **/
/**----------------INPUT REQUIRED -----------------------**/
/** PASSED ARGS        VALID VALUES                      **/
/** ACID    : THE VALID TSS DEFINED ID                   **/
/** ISPF VGETS         VALID VALUES                      **/
/**  ACID IF NOT PASSED AS AN ARG.                       **/
/**----------------OUTPUT PRODUCED-----------------------**/
/** VALID CONDITION CODES - 00                           **/
/** ISPF VARIABLES        - SECRC                        **/
/**                         MSG2                         **/
/**----------------REQUIREMENTS--------------------------**/
/** CAN RUN STANDALONE : NO                              **/
/** ISPF ENVIRONMENT   : YES                             **/
/** EXECS CALLED WITHIN THIS EXEC : T51FDIV T51GETPW     **/
/**                                                      **/
/**********************************************************/
ARG ACID
IF ACID = " " THEN ADDRESS ISPEXEC "VGET ACID  PROFILE"
SAY "T51LISTP: HAS CONTROL"
SAY "T51LISTP: CALLING T51FDIV"
SYSSCMD = SYSVAR(SYSSCMD)
SYSPCMD = SYSVAR(SYSPCMD)
SYSICMD = SYSVAR(SYSICMD)
SYSNEST = SYSVAR(SYSNEST)
SYSRACF = SYSVAR(SYSRACF)
SAY "I="SYSICMD "P=" SYSPCMD "S=" SYSSCMD "RACF= " SYSRACF
ADDRESS TSO "%T51FDIV "ACID
ADDRESS ISPEXEC "VGET SECRC PROFILE"
ADDRESS ISPEXEC "VGET AUTHNUM PROFILE"
SAY "T51LISTP: BACK FROM  T51FDIV WITH SECRC OF" SECRC
IF SECRC = "LIST FUNCTION FAILED." THEN DO
  ADDRESS TSO "%T51GETPW " ACID
  ADDRESS ISPEXEC " VGET SECRC PROFILE "
  IF SECRC ¬= "$ERROR" THEN
    SECRC = "THAT IDS PASSWORD = " SECRC
  ELSE
    SECRC = "FAILED. THAT ID DOES NOT EXIST IN UADS OR TOP SECRET"
  ADDRESS ISPEXEC " VPUT SECRC PROFILE "
  EXIT 00
END
IF SECRC = "AUTHORIZATION FAILED." THEN DO
  SECRC = "FAILED. YOUR TOP SECRET AUTHORIZATION IS INADEQUATE."
  ADDRESS ISPEXEC " VPUT SECRC PROFILE "
  EXIT 00
END
IF SECRC ¬= "CUSTDIV" THEN DO
  IF AUTHNUM < 10 THEN DO
    SECRC = "THAT ID IS NOT DEFINED AS AN EXTERNAL CUSTOMER. "
    ADDRESS ISPEXEC " VPUT SECRC PROFILE "
    IF SUBSTR(ACID            ,8,1) = "@" THEN DO
      MSG2 = "THAT IS A GHOST ENTRY, TRY LISTING THE ID WITHOUT THE @"
      ADDRESS ISPEXEC " VPUT MSG2 PROFILE "
    END
    EXIT 00
    END
  ELSE DO
    MSG2 = "SUPER (AUTH = 10) INVOKED. PASSWORD NOT NORMALLY LISTABLE"
    ADDRESS ISPEXEC "VPUT MSG2 PROFILE"
  END
END
ADDRESS TSO "%T51GDAT "ACID" ATTRIBUTES"
ADDRESS ISPEXEC "VGET SECRC PROFILE"
IF INDEX(SECRC,"SUSPEND") ¬=  0 THEN DO
  MSG2 =  "THIS ID IS SUSPENDED, YOU MUST UNSUSPEND TO USE"
  ADDRESS ISPEXEC " VPUT MSG2 PROFILE "
END
ADDRESS TSO "T51GDAT "ACID" PASSWORD PW"
ADDRESS ISPEXEC "VGET SECRC PROFILE"
IF ( SECRC = "$NOTFOUND" ) | ( SECRC = "$BADTSS" )  THEN DO
  MSG2 = "THE IDS PASSWORD IS NOT RETRIEVABLE. CONTACT TECH SUPPORT"
  ADDRESS ISPEXEC " VPUT MSG2 PROFILE "
END
ELSE
  SECRC = "THE IDS PASSWORD  = "SECRC
THEEND: NOP
ADDRESS ISPEXEC " VPUT SECRC PROFILE "
EXIT 0
